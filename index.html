<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ä¸€å‘³æ·¨ç”Ÿæ´»å’–å•¡ç³»çµ±</title>
<style>
    :root {
        --color-primary: #5c3a21; 
        --color-secondary: #9a6e4e; 
        --color-accent: #e2b34a; 
        --color-background: #fdf6e9; 
        --color-light-gray: #e6e0d8; 
        --color-done-bg: #f5f0e7; 
        --color-success: #4a7d4a; 
        --color-danger: #cf4a4a; 
        --color-total-progress: #d68910; 
        --color-section-bg: #ffffff; 
        --color-text: #333333; 
        --border-radius-lg: 12px;
        --border-radius-md: 8px;
    }

    body { 
        font-family: 'Noto Sans TC', -apple-system, BlinkMacSystemFont, sans-serif; 
        background: var(--color-background); 
        padding: 0 10px 30px 10px; 
        color: var(--color-text); 
        max-width: 960px; 
        margin: 0 auto;
        line-height: 1.6;
    }

    h2 { text-align: center; color: var(--color-primary); margin: 20px 0 15px 0; font-size: 26px; }

    /* é ‚éƒ¨å°è¦½ */
    .nav-container { display: flex; gap: 10px; justify-content: center; margin-bottom: 20px; }
    .nav-btn {
        background: #607d8b; color: white; border: none; padding: 10px 20px;
        border-radius: 50px; text-decoration: none; font-weight: bold; font-size: 14px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1); flex: 1; max-width: 150px; text-align: center;
    }

    /* è³‡è¨Šå€å¡Š */
    .info-section {
        background: var(--color-section-bg); padding: 15px; border-radius: var(--border-radius-lg);
        box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 20px; border-left: 5px solid var(--color-secondary);
    }
    .info-section h3 { color: var(--color-primary); font-size: 18px; margin: 0 0 10px 0; border-bottom: 2px dashed var(--color-light-gray); padding-bottom: 8px; }

    /* æ§åˆ¶å€ */
    .controls { background: white; padding: 15px; border-radius: 12px; box-shadow: 0 1px 4px rgba(0,0,0,0.1); margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap; }
    select { padding: 10px; font-size: 16px; border-radius: 8px; border: 1px solid #ddd; flex: 2; min-width: 150px; }
    .btn { background: var(--color-accent); color: var(--color-primary); border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; font-weight: bold; flex: 1; }
    #clearAllBtn { background: #aaaaaa; color: white; }

    /* çµ±è¨ˆå€ */
    .stats-container { display: flex; gap: 20px; margin-bottom: 20px; flex-direction: column; }
    @media (min-width: 768px) { .stats-container { flex-direction: row; } }
    .stat-box { flex: 1; background: white; border-radius: 12px; padding: 15px; box-shadow: 0 3px 10px rgba(0,0,0,0.1); border-top: 6px solid var(--color-primary); }
    
    /* è¨‚å–®è¡Œæ¨£å¼ */
    .stat-row { display: flex; justify-content: space-between; align-items: center; padding: 10px; cursor: pointer; border-radius: 6px; font-weight: 500; }
    .stat-row:hover { background: #f9f9f9; }
    .stat-row-progress { height: 6px; background: #eee; border-radius: 3px; margin: 0 10px 10px 10px; overflow: hidden; }
    .progress-fill { height: 100%; transition: width 0.3s ease; }

    /* æ˜ç´°æ¨£å¼ (å«ç¼ºå¸­åŠŸèƒ½) */
    .stat-detail-list { display: block; padding: 5px 0; border-top: 1px dashed #eee; }
    .stat-detail-item { display: flex; align-items: center; padding: 10px; border-bottom: 1px dotted #eee; }
    .stat-detail-item.done { background: #f4f4f4; opacity: 0.6; text-decoration: line-through; }
    .stat-detail-item.absent { background: #fdf2f2; opacity: 0.5; }
    .customer-info { flex: 1; display: flex; flex-direction: column; }
    .customer-name { font-weight: bold; color: var(--color-primary); display: flex; align-items: center; }
    .customer-tag { font-size: 11px; background: var(--color-accent); color: var(--color-primary); padding: 1px 5px; border-radius: 4px; margin-left: 8px; font-weight: bold; }
    .customer-loc { font-size: 12px; color: #777; }
    
    .absence-toggle { background: #eee; color: #cf4a4a; border: 1px solid #ddd; border-radius: 4px; padding: 4px 8px; font-size: 12px; cursor: pointer; margin-right: 10px; font-weight: bold; }

    /* åƒ¹æ ¼å¡ç‰‡ */
    .price-card-container { display: grid; grid-template-columns: 1fr; gap: 15px; }
    @media (min-width: 600px) { .price-card-container { grid-template-columns: 1fr 1fr; } }
    .price-card { background: white; border-radius: 12px; border: 1px solid #eee; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    .price-card-header { background: var(--color-primary); color: white; padding: 10px; text-align: center; font-weight: bold; }
    .price-grid { display: grid; grid-template-columns: 1fr 1fr; padding: 10px; }
    .price-item { padding: 8px; border-bottom: 1px solid #f9f9f9; display: flex; justify-content: space-between; font-size: 14px; }
    .p-value { color: var(--color-danger); font-weight: bold; }
    .p-value::before { content: '$'; }

    /* è±†å–®è¡¨æ ¼ - æ»¿ç‰ˆä¸æ²å‹• */
    .menu-group-full { width: 100%; border-collapse: collapse; table-layout: fixed; }
    .menu-group-full th { background: var(--color-secondary); color: white; padding: 10px 2px; font-size: 13px; }
    .menu-group-full td { padding: 10px 2px; text-align: center; font-size: 13px; border-bottom: 1px solid #eee; }
</style>
</head>
<body>

<div class="nav-container">
    <a href="https://christypy.github.io/time" class="nav-btn">â±ï¸ è¨ˆæ™‚å™¨</a>
    <a href="https://christypy.github.io/record" class="nav-btn">ğŸ“ è¨˜éŒ„å™¨</a>
</div>

<h2>â˜• ä¸€å‘³æ·¨ç”Ÿæ´»å’–å•¡å‚™é¤åŠ©ç†</h2>

<div class="controls">
    <select id="daySelect" onchange="renderOrders()">
        <option value="1">æ˜ŸæœŸä¸€ (ä¼‘)</option>
        <option value="2">æ˜ŸæœŸäºŒ</option>
        <option value="3">æ˜ŸæœŸä¸‰</option>
        <option value="4">æ˜ŸæœŸå››</option>
        <option value="5">æ˜ŸæœŸäº”</option>
        <option value="6">æ˜ŸæœŸå…­</option>
        <option value="0">æ˜ŸæœŸæ—¥</option>
    </select>
    <button class="btn" onclick="renderOrders()">åˆ·æ–°åˆ—è¡¨</button>
    <button class="btn" id="clearAllBtn" onclick="clearAllDone()">å…¨éƒ¨é‡ç½®</button>
</div>

<div class="info-section">
    <h3>ğŸ“ å¸¸é§å‚™å¿˜</h3>
    <ul id="staticMemoList" style="list-style: none; padding: 0; font-size: 14px;">
        <li><b>æé¾å«©ä»™è‰ï¼š</b>ç’°ä¿æ¯ç†±ç¾å¼</li>
        <li><b>å…§è¡£åº—è€é—†ï¼š</b>ç†±æ‹¿éµ</li>
        <li><b>èŠ­æ¨‚ï¼š</b>ç†±æ‹¿éµ + ç³–(3g)</li>
    </ul>
    <div id="dynamicMemoList"></div>
</div>

<div class="stats-container">
    <div class="stat-box" style="border-top-color: var(--color-success);">
        <h3>ğŸ  å·¦å³é„°å±… ç¸½è¨ˆ</h3>
        <div id="stats-neighbor"></div>
    </div>
    <div class="stat-box" style="border-top-color: var(--color-total-progress);">
        <h3>ğŸ›µ å…¶ä»–å€åŸŸ ç¸½è¨ˆ</h3>
        <div id="stats-other"></div>
    </div>
</div>

<div class="price-card-container">
    <div class="price-card">
        <div class="price-card-header">â˜• ç¾©å¼åŸºç¤é£²å“</div>
        <div class="price-grid">
            <div class="price-item"><span>ç†±ç¾å¼</span><span class="p-value">70</span></div>
            <div class="price-item"><span>ç†±æ‹¿éµ</span><span class="p-value">85</span></div>
            <div class="price-item"><span>å†°ç¾å¼</span><span class="p-value">75</span></div>
            <div class="price-item"><span>å†°æ‹¿éµ</span><span class="p-value">85</span></div>
            <div class="price-item"><span>å¤§ç†±ç¾</span><span class="p-value">80</span></div>
            <div class="price-item"><span>å¤§ç†±æ‹¿</span><span class="p-value">95</span></div>
            <div class="price-item"><span>æŠ¹èŒ¶æ­è•¾</span><span class="p-value">85</span></div>
            <div class="price-item"><span>å·§å…‹åŠ›æ­è•¾</span><span class="p-value">85</span></div>
            <div class="price-item"><span>ç†±ç‰›å¥¶</span><span class="p-value">50</span></div>
        </div>
    </div>
    <div class="price-card">
        <div class="price-card-header">å…¶ä»–å“é …</div>
        <div class="price-grid">
            <div class="price-item"><span>é…¸æŸ‘èŒ¶(å°)</span><span class="p-value">160</span></div>
            <div class="price-item"><span>å³æº¶(1æ¢)</span><span class="p-value">16</span></div>
            <div class="price-item"><span>é…¸æŸ‘èŒ¶(å¤§)</span><span class="p-value">950</span></div>
            <div class="price-item"><span>å³æº¶(30æ¢)</span><span class="p-value">475</span></div>
            <div class="price-item"><span>å°æ¿¾ç´™</span><span class="p-value">120</span></div>
            <div class="price-item"><span>å¤§æ¿¾ç´™</span><span class="p-value">130</span></div>
        </div>
    </div>
</div>

<div class="info-section" style="margin-top:20px;">
    <h3>ğŸ“‹ å–®å“è±†å–®åƒ¹æ ¼</h3>
    <table class="menu-group-full">
        <thead>
            <tr><th width="20%">å“é …</th><th>å¤–å¸¶</th><th>å…§ç”¨</th><th>åŠç£…</th><th>æ¿¾æ›</th></tr>
        </thead>
        <tbody>
            <tr><td>è¦º</td><td>180</td><td>230</td><td>950</td><td>-</td></tr>
            <tr><td>èŠ±</td><td>180</td><td>230</td><td>850</td><td>55</td></tr>
            <tr><td>å¯¶</td><td>180</td><td>230</td><td>850</td><td>55</td></tr>
            <tr><td>è©</td><td>130</td><td>180</td><td>700</td><td>45</td></tr>
            <tr><td>é›…</td><td>130</td><td>180</td><td>650</td><td>45</td></tr>
            <tr><td>éœ</td><td>130</td><td>180</td><td>650</td><td>45</td></tr>
            <tr><td>æœ</td><td>130</td><td>180</td><td>600</td><td>45</td></tr>
            <tr><td>ç¦</td><td>130</td><td>180</td><td>550</td><td>35</td></tr>
            <tr><td>æŸ”</td><td>130</td><td>180</td><td>450</td><td>35</td></tr>
            <tr><td>å®š/çœŸ/æ½¤</td><td>-</td><td>-</td><td>-</td><td>-</td></tr>
        </tbody>
    </table>
</div>

<script>
    const customers = [
        { loc: "å³é„°", name: "æ€¡é¦™è»’", item: "ç†±ç¾å¼", type: "hot_am", days: [], count: 1, groupId: "neighbor_r_1" },
        { loc: "å³é„°", name: "æ²¹é£¯", item: "ç†±ç¾å¼", tag: "ç•¶æ—¥å•", type: "hot_am", days: [], count: 1, groupId: "neighbor_r_2"},
        { loc: "å³é„°", name: "å±±åŸç±³é£Ÿ", item: "ç†±æ‹¿éµ", type: "hot_latte", days: [], count: 1, note: "å¯„æ¯", groupId: "neighbor_r_3" }, 
        { loc: "å³é„°", name: "æ©˜å­æ”¤", item: "ç†±æ‹¿éµ", type: "hot_latte", days: [], count: 1, groupId: "neighbor_r_4" }, 
        { loc: "å³é„°", name: "ç³–æœ", item: "ç†±æ‹¿éµ", type: "hot_latte", days: [6, 0], count: 1, note: "ä»˜å…©å¤©", groupId: "neighbor_r_5" },
        { loc: "å·¦é„°", name: "ç‰›è‚‰", item: "ç†±æ‹¿éµ", type: "hot_latte_sugar", days: [3, 5, 0], count: 1, note: "åŠ 3gç³–", groupId: "neighbor_l_1" },
        { loc: "å·¦é„°", name: "å¸ƒè€é—†", item: "ç†±ç¾å¼", type: "hot_am", days: [5], count: 1, note: "å¯„æ¯", groupId: "neighbor_l_2" },
        { loc: "å·¦é„°", name: "ç”˜è”—é›", item: "å­£ç¯€ç¾å¼", type: "hot_am", days: [], count: 1, groupId: "neighbor_l_3" },
        { loc: "å·¦é„°", name: "åœ‹è¯å“¥", item: "å†°ç¾å¼", type: "ice_am", days: [], count: 1, groupId: "neighbor_l_4" },
        { loc: "å·¦é„°", name: "å®œè˜­é­šæ”¤", item: "å†°ç¾å¼", type: "ice_am", days: [6], count: 1, groupId: "neighbor_l_5" },
        { loc: "å·¦é„°", name: "å®œè˜­é­šæ”¤", item: "å†°æ‹¿éµ", type: "ice_latte_sugar", days: [6], count: 1 ,note:"åŠ ç³–", groupId: "neighbor_l_5"},
        { loc: "å€åŸŸ", name: "è³£é­šå“¡å·¥", item: "å¤§ç†±ç¾", type: "large_hot_am", days: [6,0], note: "å…­çµ¦å…©å¤©éŒ¢", groupId: "other_1" },
        { loc: "å€åŸŸ", name: "ç‰›è‚‰çˆ¸çˆ¸", item: "å¤§æ‹¿éµ", type: "large_hot_latte", days: [], note: "çˆ¸çˆ¸ç²‰20g", groupId: "other_2" },
        { loc: "å€åŸŸ", name: "ç‰›è‚‰å…’å­", item: "å¤§æ‹¿éµ", type: "large_hot_latte", days: [], groupId: "other_2" },
        { loc: "å€åŸŸ", name: "é­šè€é—†", item: "å¤§æ‹¿éµ", type: "large_hot_latte", days: [2, 3, 5], note: "å¯„æ¯", groupId: "other_3" },
        { loc: "å€åŸŸ", name: "é­šè€é—†é„°å±…", item: "ç†±æ‹¿éµ", type: "hot_latte", days: [2, 3, 6, 0], groupId: "other_4" }, 
        { loc: "å€åŸŸ", name: "å°è¾£æ¤’", item: "ç†±ç¾å¼", type: "hot_am", days: [], groupId: "other_5" },
        { loc: "å€åŸŸ", name: "è¦è€é—†", item: "ç†±ç¾å¼", type: "hot_am", days: [2, 4, 5, 6, 0], groupId: "other_6" },
        { loc: "å€åŸŸ", name: "æ¢¨å±±èœœè˜‹æœ", item: "ç†±æ‹¿éµ", tag: "ç•¶æ—¥å•", type: "hot_latte", days: [4,5], groupId: "other_7" }, 
        { loc: "å€åŸŸ", name: "æŠ“é¤…å¥³è€é—†", item: "ç†±ç¾å¼", tag: "ç•¶æ—¥å•", type: "hot_am", days: [2,4], groupId: "other_10" },
        { loc: "å€åŸŸ", name: "è±åŸç´ é£Ÿ", item: "ç†±ç¾å¼", type: "hot_am", days: [3], groupId: "other_11" },
        { loc: "å€åŸŸ", name: "åŸéšå»Ÿå£è±†è…", item: "å†°ç¾å¼", type: "ice_am", days: [6], note:"ç•¶å¤©å•", groupId: "other_18" }
    ];

    const typeNames = { hot_am: 'â˜• ç†±ç¾å¼', ice_am: 'ğŸ§Š å†°ç¾å¼', large_hot_am:"â˜•ï¸ å¤§ç†±ç¾", hot_latte: 'ğŸ”¥ ç†±æ‹¿éµ', hot_latte_sugar: 'ğŸ¬ ç†±æ‹¿éµ (åŠ ç³–)', ice_latte_sugar: 'ğŸ­ å†°æ‹¿éµ (åŠ ç³–)', large_hot_latte: 'ğŸ¥¤ å¤§ç†±æ‹¿' };

    function getTodayKey() { const t = new Date(); return t.getFullYear() + (t.getMonth()+1).toString().padStart(2,'0') + t.getDate().toString().padStart(2,'0'); }

    window.toggleDone = function(name, item, index, groupId) {
        if (localStorage.getItem(`${getTodayKey()}_absent_${groupId}`)) return;
        const key = `${getTodayKey()}_${name}_${item}_${index}`;
        localStorage.getItem(key) === 'true' ? localStorage.removeItem(key) : localStorage.setItem(key, 'true');
        renderOrders();
    }

    window.toggleAbsence = function(groupId) {
        const key = `${getTodayKey()}_absent_${groupId}`;
        localStorage.getItem(key) === 'true' ? localStorage.removeItem(key) : localStorage.setItem(key, 'true');
        renderOrders();
    }

    function renderOrders() {
        const day = parseInt(document.getElementById('daySelect').value);
        const sNDiv = document.getElementById('stats-neighbor');
        const sODiv = document.getElementById('stats-other');
        
        if (day === 1) { sNDiv.innerHTML = sODiv.innerHTML = '<div style="text-align:center;color:#999;padding:10px;">æœ¬æ—¥ä¼‘æ¯</div>'; return; }

        let sNeigh = {}, sOther = {};
        for (const k in typeNames) { sNeigh[k] = {total:0, done:0, orders:[]}; sOther[k] = {total:0, done:0, orders:[]}; }

        const todaysOrders = customers.filter(c => c.days.length === 0 || c.days.includes(day));

        todaysOrders.forEach(c => {
            let target = (c.loc.includes("é„°")) ? sNeigh : sOther;
            let isAbsent = localStorage.getItem(`${getTodayKey()}_absent_${c.groupId}`) === 'true';
            if (typeNames[c.type]) {
                if (!isAbsent) target[c.type].total += (c.count || 1);
                for(let i=0; i<(c.count||1); i++){
                    let done = localStorage.getItem(`${getTodayKey()}_${c.name}_${c.item}_${i}`) === 'true';
                    if (done && !isAbsent) target[c.type].done++;
                    target[c.type].orders.push({...c, isDone: done, isAbsent, index: i});
                }
            }
        });

        const makeHtml = (stats, prefix) => {
            let html = '';
            for (const k in typeNames) {
                if (stats[k].total > 0) {
                    let s = stats[k], rem = s.total - s.done, per = Math.round((s.done/s.total)*100);
                    html += `<div class="stat-row"><span>${typeNames[k]}</span><span>${s.total} (å‰©: ${rem})</span></div>
                            <div class="stat-row-progress"><div class="progress-fill" style="width:${per}%; background:${rem===0?'#4a7d4a':'#e2b34a'}"></div></div>
                            <div class="stat-detail-list">
                            ${s.orders.map(o => `<div class="stat-detail-item ${o.isAbsent?'absent':(o.isDone?'done':'')}">
                                <button class="absence-toggle" onclick="toggleAbsence('${o.groupId}')">${o.isAbsent?'å–æ¶ˆç¼ºå¸­':'æ¨™è¨˜ç¼ºå¸­'}</button>
                                <div class="customer-info" onclick="toggleDone('${o.name}','${o.item}',${o.index},'${o.groupId}')">
                                    <span class="customer-name">${o.name} ${o.tag||o.note?`<span class="customer-tag">${o.tag||o.note}</span>`:''}</span>
                                    <span class="customer-loc">${o.item}</span>
                                </div>
                                <input type="checkbox" ${o.isDone?'checked':''} ${o.isAbsent?'disabled':''}>
                            </div>`).join('')}</div>`;
                }
            }
            return html || 'ç„¡è¨‚å–®';
        };
        sNDiv.innerHTML = makeHtml(sNeigh, 'n');
        sODiv.innerHTML = makeHtml(sOther, 'o');
    }

    window.clearAllDone = function() { if(confirm("ç¢ºå®šé‡ç½®ä»Šæ—¥æ‰€æœ‰ç‹€æ…‹ï¼Ÿ")) { localStorage.clear(); renderOrders(); } }

    document.getElementById('daySelect').value = new Date().getDay();
    renderOrders();
</script>
</body>
</html>
