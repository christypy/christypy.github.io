<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ä¸€å‘³æ·¨ç”Ÿæ´»å’–å•¡ç³»çµ± - é›²ç«¯ç‰ˆ</title>
<style>
    /* å…¨å±€è®Šæ•¸èˆ‡é…è‰²å„ªåŒ– */
    :root {
        --color-primary: #5c3a21; --color-secondary: #9a6e4e; --color-accent: #e2b34a;
        --color-background: #fdf6e9; --color-light-gray: #e6e0d8; --color-done-bg: #f5f0e7;
        --color-success: #4a7d4a; --color-danger: #cf4a4a; --color-total-progress: #d68910;
        --color-section-bg: #ffffff; --color-text: #333333;
        --shadow-subtle: 0 1px 4px rgba(0,0,0,0.08); --shadow-medium: 0 3px 8px rgba(0,0,0,0.1);
        --border-radius-lg: 12px; --border-radius-md: 8px;
    }

    body { 
        font-family: 'Noto Sans TC', -apple-system, sans-serif; 
        background: var(--color-background); padding: 0 15px 30px 15px; 
        color: var(--color-text); max-width: 960px; margin: 0 auto; line-height: 1.6;
    }
    h2 { text-align: center; color: var(--color-primary); margin: 20px 0 15px 0; font-size: 30px; font-weight: 700; }
    
    .info-section {
        background: var(--color-section-bg); padding: 15px; border-radius: var(--border-radius-lg);
        box-shadow: var(--shadow-medium); margin-bottom: 20px; border-left: 5px solid var(--color-secondary);
    }
    .info-section h3 { color: var(--color-primary); font-size: 18px; margin: 0 0 10px 0; border-bottom: 2px dashed var(--color-light-gray); padding-bottom: 8px; }
    .info-section ul { list-style: none; padding: 0; margin: 0; }
    .info-section li { font-size: 14px; padding: 4px 0; }
    .info-section li b { color: var(--color-danger); }
    
    #dynamicMemoList { display: flex; flex-wrap: wrap; gap: 15px; padding-top: 5px; }
    .dynamic-memo-title { width: 100%; margin-top: 10px; color: var(--color-danger); font-weight: bold; border-top: 2px dashed var(--color-danger); }
    .dynamic-memo-item { color: var(--color-primary); font-weight: 600; white-space: nowrap; }
    .dynamic-memo-item .memo-tag { color: white; background-color: var(--color-total-progress); padding: 2px 6px; border-radius: 4px; margin-left: 5px; font-size: 12px; }

    .controls { background: var(--color-section-bg); padding: 15px; border-radius: var(--border-radius-lg); box-shadow: var(--shadow-subtle); margin-bottom: 20px; display: flex; gap: 10px; }
    select { padding: 12px; font-size: 16px; border-radius: var(--border-radius-md); border: 1px solid var(--color-light-gray); flex-grow: 2; cursor: pointer; }
    .btn { background: var(--color-accent); color: var(--color-primary); border: none; padding: 12px 15px; border-radius: var(--border-radius-md); cursor: pointer; font-weight: bold; flex-grow: 1; }
    
    .stats-container { display: flex; gap: 20px; margin-bottom: 20px; }
    .stat-box { flex: 1; background: var(--color-section-bg); border-radius: var(--border-radius-lg); padding: 15px; box-shadow: var(--shadow-medium); border-top: 6px solid var(--color-primary); }
    .stat-box h3 { margin: 0 0 10px 0; font-size: 16px; text-align: center; border-bottom: 1px solid var(--color-light-gray); padding-bottom: 8px; }
    .stat-row { display: flex; justify-content: space-between; align-items: center; padding: 8px 10px; cursor: pointer; border-radius: 6px; }
    .stat-row.total { font-weight: 700; border-top: 2px solid var(--color-light-gray); margin-top: 15px; padding-top: 12px; }
    .stat-row-progress { height: 5px; background-color: var(--color-light-gray); border-radius: 2px; margin: 0 10px 8px 10px; overflow: hidden; }
    .progress-fill { height: 100%; transition: width 0.3s ease; }
    
    .stat-detail-list { margin-top: 8px; border-top: 1px dashed var(--color-light-gray); }
    .stat-detail-item { display: flex; align-items: center; padding: 8px 10px; border-bottom: 1px dotted #e0e0e0; cursor: pointer; }
    .stat-detail-item.done { background-color: var(--color-done-bg); color: #888; text-decoration: line-through; }
    .customer-info { display: flex; flex-direction: column; flex-grow: 1; }
    .customer-name { font-weight: 600; color: var(--color-primary); }
    .customer-tag { font-size: 11px; background-color: var(--color-accent); color: var(--color-primary); padding: 1px 4px; border-radius: 3px; margin-left: 8px; }

    /* Checkbox */
    .stat-detail-item input[type="checkbox"] { width: 20px; height: 20px; border: 2px solid var(--color-secondary); cursor: pointer; }
    .stat-detail-item .absence-toggle { background: #f4f4f4; color: var(--color-danger); border: 1px solid var(--color-light-gray); border-radius: 4px; padding: 4px 8px; margin-right: 10px; font-size: 14px; }
    .stat-detail-item.absent { background-color: #f7f7f7; opacity: 0.6; }

    /* åƒ¹æ ¼å¡ç‰‡ */
    .price-card-container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 25px; }
    .price-card { background: #fff; border-radius: var(--border-radius-lg); box-shadow: var(--shadow-medium); overflow: hidden; border: 1px solid var(--color-light-gray); }
    .price-card-header { background: var(--color-primary); color: #fff; padding: 10px; text-align: center; font-weight: bold; }
    .price-grid { display: grid; grid-template-columns: 1fr 1fr; padding: 10px; }
    .price-item { padding: 8px; border-bottom: 1px solid #f0f0f0; display: flex; justify-content: space-between; font-size: 14px; }
    .price-item .p-value::before { content: '$'; }

    .menu-group-full { width: 100%; border-collapse: collapse; margin-top: 10px; background: #fff; }
    .menu-group-full th { background: var(--color-secondary); color: white; padding: 10px; }
    .menu-group-full td { padding: 10px; text-align: center; border-bottom: 1px solid #eee; }
    .menu-price::before { content: '$'; }

    .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.7); display: none; justify-content: center; align-items: center; z-index: 1000; font-weight: bold; }

    @media (max-width: 768px) { .price-card-container, .stats-container { grid-template-columns: 1fr; flex-direction: column; } }
</style>
</head>
<body>

<div id="loading" class="loading-overlay">é›²ç«¯åŒæ­¥ä¸­...</div>

<h2>â˜• ä¸€å‘³æ·¨ç”Ÿæ´»å’–å•¡å‚™é¤åŠ©ç† (é›²ç«¯ç‰ˆ)</h2>

<div class="controls">
    <select id="daySelect" onchange="renderOrders()">
        <option value="1">æ˜ŸæœŸä¸€ (ä¼‘)</option>
        <option value="2">æ˜ŸæœŸäºŒ</option>
        <option value="3">æ˜ŸæœŸä¸‰</option>
        <option value="4">æ˜ŸæœŸå››</option>
        <option value="5">æ˜ŸæœŸäº”</option>
        <option value="6">æ˜ŸæœŸå…­</option>
        <option value="0">æ˜ŸæœŸæ—¥</option>
    </select>
    <button class="btn" onclick="syncData()">æ‰‹å‹•åŒæ­¥</button>
    <button class="btn" id="clearAllBtn" onclick="clearAllDone()">å…¨éƒ¨é‡ç½®</button>
</div>

<div class="info-section">
    <h3>ğŸ“ å‚™å¿˜</h3>
    <ul id="staticMemoList">
        <li><b>æé¾å«©ä»™è‰ï¼š</b>ç’°ä¿æ¯ç†±ç¾å¼</li>
        <li><b>å…§è¡£åº—è€é—†ï¼š</b>ç†±æ‹¿éµ</li>
        <li><b>èŠ­æ¨‚ï¼š</b>ç†±æ‹¿éµ + ç³–(3g)</li>
    </ul>
    <ul id="dynamicMemoList"></ul>
</div>

<div class="stats-container">
    <div class="stat-box" style="border-top-color: var(--color-success);">
        <h3>ğŸ  å·¦å³é„°å±… ç¸½è¨ˆ</h3>
        <div id="stats-neighbor"></div>
    </div>
    <div class="stat-box" style="border-top-color: var(--color-total-progress);">
        <h3>ğŸ›µ å…¶ä»–å€åŸŸ ç¸½è¨ˆ</h3>
        <div id="stats-other"></div>
    </div>
</div>

<div class="price-card-container">
    <div class="price-card">
        <div class="price-card-header">â˜• ç¾©å¼åŸºç¤é£²å“</div>
        <div class="price-grid">
            <div class="price-item"><span class="p-name">ç†±ç¾å¼</span><span class="p-value">70</span></div>
            <div class="price-item"><span class="p-name">ç†±æ‹¿éµ</span><span class="p-value">85</span></div>
            <div class="price-item"><span class="p-name">å†°ç¾å¼</span><span class="p-value">75</span></div>
            <div class="price-item"><span class="p-name">å†°æ‹¿éµ</span><span class="p-value">85</span></div>
            <div class="price-item"><span class="p-name">å¤§ç†±ç¾</span><span class="p-value">80</span></div>
            <div class="price-item"><span class="p-name">å¤§ç†±æ‹¿</span><span class="p-value">95</span></div>
            <div class="price-item"><span class="p-name">ç†±ç‰›å¥¶</span><span class="p-value">50</span></div>
            <div class="price-item"><span class="p-name">æŠ¹èŒ¶æ‹¿éµ</span><span class="p-value">85</span></div>
        </div>
    </div>
    <div class="price-card">
        <div class="price-card-header">å…¶ä»–å“é …</div>
        <div class="price-grid">
            <div class="price-item"><span class="p-name">é…¸æŸ‘èŒ¶(å°)</span><span class="p-value">160</span></div>
            <div class="price-item"><span class="p-name">å³æº¶(1æ¢)</span><span class="p-value">16</span></div>
            <div class="price-item"><span class="p-name">é…¸æŸ‘èŒ¶(å¤§)</span><span class="p-value">950</span></div>
            <div class="price-item"><span class="p-name">å³æº¶(ç›’)</span><span class="p-value">475</span></div>
            <div class="price-item"><span class="p-name">å°æ¿¾ç´™</span><span class="p-value">120</span></div>
            <div class="price-item"><span class="p-name">å¤§æ¿¾ç´™</span><span class="p-value">130</span></div>
        </div>
    </div>
</div>

<div class="info-section">
    <h3>ğŸ“‹ å–®å“è±†å–®åƒè€ƒ</h3>
    <table class="menu-group-full">
        <thead><tr><th>å“é …</th><th>å¤–å¸¶</th><th>å…§ç”¨</th><th>åŠç£…</th><th>æ¿¾æ›</th></tr></thead>
        <tbody>
            <tr><td>å¯¶</td><td>180</td><td>200</td><td>850</td><td>55</td></tr>
            <tr><td>èŠ±</td><td>180</td><td>230</td><td>850</td><td>55</td></tr>
            <tr><td>é›…</td><td>130</td><td>180</td><td>650</td><td>45</td></tr>
            <tr><td>æœ</td><td>130</td><td>180</td><td>600</td><td>45</td></tr>
            <tr><td>è©</td><td>130</td><td>180</td><td>700</td><td>45</td></tr>
        </tbody>
    </table>
</div>

<script>
    // --- é‡è¦ï¼šè«‹åœ¨æ­¤è™•æ›¿æ›æ‚¨çš„ Google Apps Script URL ---
    const API_URL = 'https://script.google.com/macros/s/AKfycbyhIFvp4n6Nynt3ALoIE4kTeLCL5EyhEN0RIxuafC7S-GcC9Lyh1Qws5tMR6YkPGipQLQ/exec'; 

    let cloudData = {}; 
    const expandedStats = new Set();

    const customers = [
        { loc: "å³é‚Šé„°å±…", name: "æ€¡é¦™è»’", item: "ç†±ç¾å¼", type: "hot_am", days: [], count: 1, groupId: "neighbor_r_1" },
        { loc: "å³é‚Šé„°å±…", name: "æ²¹é£¯", item: "ç†±ç¾å¼", tag: "ç•¶æ—¥å•",type: "hot_am", days: [], count: 1, groupId: "neighbor_r_2"},
        { loc: "å³é‚Šé„°å±…", name: "å±±åŸç±³é£Ÿ", item: "ç†±æ‹¿éµ", type: "hot_latte", days: [], count: 1, note: "å¯„æ¯", groupId: "neighbor_r_3" }, 
        { loc: "å³é‚Šé„°å±…", name: "æ©˜å­æ”¤", item: "ç†±æ‹¿éµ", type: "hot_latte", days: [], count: 1, groupId: "neighbor_r_4" }, 
        { loc: "å³é‚Šé„°å±…", name: "ç³–æœ", item: "ç†±æ‹¿éµ", type: "hot_latte", days: [6, 0], count: 1, note: "ä»˜å…©å¤©", groupId: "neighbor_r_5" },
        { loc: "å·¦é‚Šé„°å±…", name: "ç‰›è‚‰", item: "ç†±æ‹¿éµ", type: "hot_latte_sugar", days: [3, 5, 0], count: 1, note: "åŠ 3gç³–", groupId: "neighbor_l_1" },
        { loc: "å·¦é‚Šé„°å±…", name: "å¸ƒè€é—†", item: "ç†±ç¾å¼", type: "hot_am", days: [5], count: 1, note: "å¯„æ¯", groupId: "neighbor_l_2" },
        { loc: "å·¦é‚Šé„°å±…", name: "ç”˜è”—é›", item: [10, 11, 0, 1, 2].includes(new Date().getMonth()) ? "ç†±ç¾å¼" : "å†°ç¾å¼", type: [10, 11, 0, 1, 2].includes(new Date().getMonth()) ? "hot_am" : "ice_am", days: [], count: 1, groupId: "neighbor_l_3" },
        { loc: "å·¦é‚Šé„°å±…", name: "åœ‹è¯å“¥", item: "å†°ç¾å¼", type: "ice_am", days: [], count: 1, groupId: "neighbor_l_4" },
        { loc: "å·¦é‚Šé„°å±…", name: "å®œè˜­é­šæ”¤", item: "å†°ç¾å¼", type: "ice_am", days: [6], count: 1, groupId: "neighbor_l_5" },
        { loc: "å·¦é‚Šé„°å±…", name: "å®œè˜­é­šæ”¤", item: "å†°æ‹¿éµ", type: "ice_latte_sugar", days: [6], count: 1 ,note:"åŠ ç³–", groupId: "neighbor_l_5"},
        { loc: "æé¾å«©ä»™è‰å°é¢", name: "è³£é­šçš„å“¡å·¥", item: "å¤§ç†±ç¾", type: "large_hot_am", days: [6,0], note: "å…­çµ¦å…©å¤©éŒ¢", groupId: "other_1" },
        { loc: "è¿‘åå­—è·¯å£", name: "ç‰›è‚‰çˆ¸çˆ¸", item: "å¤§æ‹¿éµ", count: 1, type: "large_hot_latte", days: [], note: "çˆ¸çˆ¸ç²‰å¤š1g", groupId: "other_2" },
        { loc: "è¿‘åå­—è·¯å£", name: "ç‰›è‚‰å…’å­", item: "å¤§æ‹¿éµ", count: 1, type: "large_hot_latte", days: [], groupId: "other_2" },
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "é­šè€é—†", item: "å¤§æ‹¿éµ", type: "large_hot_latte", days: [2, 3, 5], count: 1, note: "å¯„æ¯", groupId: "other_3" },
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "é­šè€é—†é„°å±…(æ°´æœ)", item: "ç†±æ‹¿éµ", type: "hot_latte", days: [2, 3, 6, 0], count: 1, groupId: "other_4" }, 
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "å°è¾£æ¤’", item: "ç†±ç¾å¼", type: "hot_am", days: [], count: 1, groupId: "other_5" },
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "è¦è€é—†", item: "ç†±ç¾å¼",type: "hot_am", days: [2, 4, 5, 6, 0], count: 1, groupId: "other_6" },
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "æ¢¨å±±èœœè˜‹æœ", item: "ç†±æ‹¿éµ",tag: "ç•¶æ—¥å•", type: "hot_latte", days: [4,5], count: 1, groupId: "other_7" }, 
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "åŸéšå»Ÿå£éµé‹è¡Œ", item: "å†°ç¾å¼",  count: 2, type: "ice_am", days: [5], groupId: "other_8" }, 
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "çœ¼é¡ç™½é«®å°èœè€é—†", item: "å†°æ‰‹æ²–|é›…", type: "hand_drip",tag: "ç•¶æ—¥å•è€å®¢æˆ¶æ‰‹æ²–100", days: [4], count: 1, groupId: "other_9"  },
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "æŠ“é¤…å¥³è€é—†", item: "ç†±ç¾å¼",tag: "ç•¶æ—¥å•", type: "hot_am", days: [2,4], count: 1, groupId: "other_10" },
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "è±åŸç´ é£Ÿ", item: "ç†±ç¾å¼", type: "hot_am", days: [3], count: 1, groupId: "other_11" },
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "è¿‘ä¸­å±±è·¯æ°´æœæ”¤", item: "ç†±ç¾å¼", type: "hot_am", days: [], count: 1, groupId: "other_12" },
        { loc: "éåå­—è·¯å£å³è½‰", name: "ç¦è¨˜å°é¢è±¬è‚‰", item: "ç†±ç¾å¼", type: "hot_am", days: [], count: 1, note: "å¯„æ¯", groupId: "other_13" },
        { loc: "å¸‚å ´å…§", name: "åœ‹è¯å“¥åª½åª½", item: "ç†±ç¾å¼", type: "hot_am", days: [2,5], count: 1, groupId: "other_14" },
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "åŸéšå»Ÿå£è²¢ä¸¸ ", item: "ç†±æ‹¿éµ", type: "hot_latte", days: [2], count: 1, groupId: "other_15" },
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "è²¢ä¸¸è€é—† (æ‹¿)", item: "ç†±æ‹¿éµ", type: "hot_latte", days: [3, 0], count: 1, groupId: "other_16" },
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "è²¢ä¸¸è€é—† (æ‰‹)", item: "ç†±æ‰‹æ²–", type: "hand_drip", days: [3, 0], count: 1, note: "ç¸½è¨ˆ$185", groupId: "other_16" },
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "èœè€é—†", item: "ç†±æ‹¿éµ", type: "hot_latte", days: [], count: 1, groupId: "other_17" },
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "åŸéšå»Ÿå£è±†è…", item: "å†°ç¾å¼",   type: "ice_am", days: [6], note:"ç•¶å¤©å•",groupId: "other_18" }, 
    ];

    const typeNames = {
        hot_am: 'â˜• ç†±ç¾å¼', ice_am: 'ğŸ§Š å†°ç¾å¼', large_hot_am:"â˜•ï¸ å¤§ç†±ç¾",
        hot_latte: 'ğŸ”¥ ç†±æ‹¿éµ', hot_latte_sugar: 'ğŸ¬ ç†±æ‹¿éµ (åŠ ç³–)', 
        ice_latte_sugar: 'ğŸ­ å†°æ‹¿éµ (åŠ ç³–)', ice_latte: 'â„ï¸ å†°æ‹¿éµ', 
        large_hot_latte: 'ğŸ¥¤ å¤§ç†±æ‹¿', hand_drip: 'ğŸ’§ æ‰‹æ²–'
    };

    function showLoading(show) { document.getElementById('loading').style.display = show ? 'flex' : 'none'; }

    async function syncData() {
        showLoading(true);
        try {
            const resp = await fetch(API_URL);
            cloudData = await resp.json();
            renderOrders();
        } catch (e) { console.error(e); }
        showLoading(false);
    }

    async function updateCloud(key, value) {
        showLoading(true);
        try {
            await fetch(API_URL, { method: 'POST', body: JSON.stringify({ key, value }) });
            if (value === 'delete') delete cloudData[key]; else cloudData[key] = value;
            renderOrders();
        } catch (e) { alert('åŒæ­¥å¤±æ•—'); }
        showLoading(false);
    }

    function getTodayDateString() {
        const t = new Date();
        return t.getFullYear() + (t.getMonth() + 1).toString().padStart(2, '0') + t.getDate().toString().padStart(2, '0');
    }

    function getStorageKey(n, i, l, idx = 0) { 
        const s = (str) => str.replace(/[^a-zA-Z0-9\u4e00-\u9fa5]/g, '');
        return `${getTodayDateString()}_${s(n)}_${s(i)}_${idx}`; 
    }
    
    function getAbsenceKey(id) { return `${getTodayDateString()}_absent_${id}`; }

    window.toggleDone = function(n, i, l, idx, gid) {
        if (cloudData[getAbsenceKey(gid)] === 'true') return;
        const key = getStorageKey(n, i, l, idx);
        updateCloud(key, cloudData[key] === 'true' ? 'delete' : 'true');
    }

    window.toggleAbsence = function(gid) {
        const key = getAbsenceKey(gid);
        updateCloud(key, cloudData[key] === 'true' ? 'delete' : 'true');
    }

    window.clearAllDone = async function() {
        if (!confirm("ç¢ºå®šé‡ç½®é›²ç«¯ä»Šæ—¥ç‹€æ…‹ï¼Ÿ")) return;
        showLoading(true);
        await fetch(API_URL, { method: 'POST', body: JSON.stringify({ value: 'clearAll' }) });
        cloudData = {};
        renderOrders();
        showLoading(false);
    }

    function renderOrders() {
        const day = parseInt(document.getElementById('daySelect').value);
        const sNDiv = document.getElementById('stats-neighbor');
        const sODiv = document.getElementById('stats-other');
        
        if (day === 1) { sNDiv.innerHTML = sODiv.innerHTML = '<div style="text-align:center;color:#999;">æœ¬æ—¥ä¼‘æ¯</div>'; return; }

        let sN = {}, sO = {};
        for (const k in typeNames) { sN[k] = {total:0, done:0, orders:[]}; sO[k] = {total:0, done:0, orders:[]}; }

        const todays = customers.filter(c => c.days.length === 0 || c.days.includes(day));
        
        todays.forEach(c => {
            let target = c.loc.includes("é„°å±…") ? sN : sO;
            let abs = cloudData[getAbsenceKey(c.groupId)] === 'true';
            if (typeNames[c.type]) {
                if (!abs) target[c.type].total += c.count;
                for(let i=0; i<c.count; i++) {
                    let done = cloudData[getStorageKey(c.name, c.item, c.loc, i)] === 'true';
                    if (done && !abs) target[c.type].done++;
                    target[c.type].orders.push({...c, isDone: done, isAbsent: abs, index: i});
                }
            }
        });

        const makeHtml = (stats, prefix) => {
            let html = '', tN = 0, tD = 0;
            for (const k in typeNames) {
                if (stats[k].total > 0 || stats[k].orders.length > 0) {
                    let s = stats[k], rem = s.total - s.done, per = (s.done/s.total)*100 || 0;
                    let id = `det_${prefix}_${k}`;
                    html += `<div class="stat-row" onclick="toggleStatDetail('${id}')"><span>${typeNames[k]}</span><div>å‰©: <b style="${rem===0?'color:var(--color-success)':''}">${rem}</b> / ${s.total}</div></div><div class="stat-row-progress"><div class="progress-fill" style="width:${per}%; background-color:${rem===0?'var(--color-success)':'var(--color-accent)'};"></div></div><div id="${id}" class="stat-detail-list" style="display:block;">${s.orders.map(o => `
                        <div class="stat-detail-item ${o.isAbsent?'absent':(o.isDone?'done':'')}">
                            <span class="absence-toggle" onclick="event.stopPropagation(); toggleAbsence('${o.groupId}')">${o.isAbsent?'æ¢å¾©':'ç¼ºå¸­'}</span>
                            <div class="customer-info" onclick="toggleDone('${o.name.replace(/'/g,"\\'")}','${o.item}','${o.loc}',${o.index},'${o.groupId}')">
                                <span class="customer-name">${o.name} ${o.tag||o.note?`<span class="customer-tag">${o.tag||o.note}</span>`:''}</span>
                                <small>${o.item}</small>
                            </div>
                            <input type="checkbox" ${o.isDone||o.isAbsent?'checked':''} disabled>
                        </div>`).join('')}</div>`;
                    tN += s.total; tD += s.done;
                }
            }
            if(tN > 0) {
                let rem = tN - tD, per = (tD/tN)*100;
                html += `<div class="stat-row total"><span>ğŸ† ç¸½è¨ˆ</span><div>å‰©: <b>${rem}</b> / ${tN}</div></div><div class="stat-row-progress"><div class="progress-fill" style="width:${per}%; background-color:var(--color-total-progress);"></div></div>`;
            }
            return html || 'ç„¡è¨‚å–®';
        };
        sNDiv.innerHTML = makeHtml(sN, 'n'); sODiv.innerHTML = makeHtml(sO, 'o');
    }

    window.toggleStatDetail = (id) => { const el = document.getElementById(id); el.style.display = el.style.display==='none'?'block':'none'; };

    document.getElementById('daySelect').value = new Date().getDay();
    syncData();
</script>
</body>
</html>