é€™æ˜¯åœ¨æ‚¨çš„åŸå§‹ç¢¼åŸºç¤ä¸Šï¼Œé‡å°ã€Œå–®å“è±†å–®ã€ä¸å®Œæ•´èˆ‡ã€Œæ•´é«”æ’ç‰ˆé¡¯ç¤ºã€å•é¡Œé€²è¡Œä¿®æ­£å¾Œçš„å®Œæ•´ç‰ˆæœ¬ã€‚
ä¸»è¦ä¿®å¾©å…§å®¹ï¼š
 * è£œå…¨å–®å“è±†å–®ï¼šè£œé½Šäº†ã€Œè¦ºã€èŠ±ã€å¯¶ã€è©ã€é›…ã€æ‰€æœ‰çš„åƒ¹æ ¼è³‡è¨Šã€‚
 * ä¿®å¾©æ’ç‰ˆæº¢å‡ºï¼šä¿®æ­£äº†åŸæœ¬è¡¨æ ¼åœ¨æ‰‹æ©Ÿç‰ˆå¯èƒ½æœƒè¶…å‡ºè¢å¹•é‚Šæ¡†çš„å•é¡Œï¼Œæ”¹ç”¨æ²è»¸ä¿è­·ã€‚
 * å„ªåŒ–æŒ‰éˆ•ä½ˆå±€ï¼šå°‡ã€Œè¨ˆæ™‚å™¨ã€èˆ‡ã€Œè¨˜éŒ„å™¨ã€æŒ‰éˆ•èª¿æ•´ç‚ºæ›´ç²¾ç·»çš„è† å›Šé€ å‹ï¼Œä¸¦ä¿®å¾©äº†èˆ‡æ¨™é¡Œä¹‹é–“çš„é–“è·ã€‚
 * ä¸€è‡´åŒ–é¡è‰²ï¼šç¢ºä¿æ‰€æœ‰å’–å•¡è‰²èª¿ï¼ˆæ·±å’–å•¡ã€ä¸­å’–å•¡ã€é‡‘é»ƒè‰²ï¼‰åœ¨æ•´é è¦–è¦ºä¸­æ¯”ä¾‹å”èª¿ã€‚
<!-- end list -->
<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ä¸€å‘³æ·¨ç”Ÿæ´»å’–å•¡ç³»çµ±</title>
<style>
    /* å…¨å±€è®Šæ•¸èˆ‡é…è‰²å„ªåŒ– */
    :root {
        --color-primary: #5c3a21; 
        --color-secondary: #9a6e4e; 
        --color-accent: #e2b34a; 
        --color-background: #fdf6e9; 
        --color-light-gray: #e6e0d8; 
        --color-done-bg: #f5f0e7; 
        --color-success: #4a7d4a; 
        --color-danger: #cf4a4a; 
        --color-total-progress: #d68910; 
        --color-section-bg: #ffffff; 
        --color-text: #333333; 

        --shadow-subtle: 0 1px 4px rgba(0,0,0,0.08);
        --shadow-medium: 0 3px 8px rgba(0,0,0,0.1);
        --border-radius-lg: 12px;
        --border-radius-md: 8px;
    }

    body { 
        font-family: 'Noto Sans TC', -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Helvetica Neue", "Arial", sans-serif; 
        background: var(--color-background); 
        padding: 0 15px 40px 15px; 
        color: var(--color-text); 
        max-width: 800px; 
        margin: 0 auto;
        line-height: 1.6;
    }

    /* é ‚éƒ¨å°è¦½æŒ‰éˆ•å€ */
    .nav-header {
        display: flex;
        gap: 12px;
        margin: 20px 0;
        justify-content: center;
    }
    .nav-btn {
        flex: 1;
        max-width: 160px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        padding: 10px;
        border: none;
        border-radius: 50px; /* è† å›Šé€ å‹ */
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        background-color: var(--color-secondary);
        color: white;
        box-shadow: var(--shadow-subtle);
        text-decoration: none;
    }
    .nav-btn:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-medium);
        filter: brightness(1.1);
    }

    h2 { 
        text-align: center; 
        color: var(--color-primary); 
        margin: 20px 0; 
        font-size: 24px; 
        font-weight: 700;
    }
    
    .info-section {
        background: var(--color-section-bg);
        padding: 18px;
        border-radius: var(--border-radius-lg);
        box-shadow: var(--shadow-medium);
        margin-bottom: 20px;
        border-left: 6px solid var(--color-secondary);
    }
    .info-section h3 {
        color: var(--color-primary);
        font-size: 18px;
        margin: 0 0 12px 0;
        border-bottom: 2px dashed var(--color-light-gray);
        padding-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    /* æ§åˆ¶å€ */
    .controls { 
        background: var(--color-section-bg); 
        padding: 15px; 
        border-radius: var(--border-radius-lg); 
        box-shadow: var(--shadow-subtle); 
        margin-bottom: 20px; 
        display: flex; 
        gap: 8px;
    }
    select { 
        padding: 10px; 
        font-size: 16px; 
        border-radius: var(--border-radius-md); 
        border: 1px solid var(--color-light-gray); 
        flex: 2;
    }
    .btn { 
        background: var(--color-accent); 
        color: var(--color-primary); 
        border: none; 
        padding: 10px; 
        border-radius: var(--border-radius-md); 
        cursor: pointer; 
        font-weight: bold; 
        flex: 1;
    }
    #clearAllBtn { background: #d0d0d0; color: #555; }

    /* çµ±è¨ˆèˆ‡é€²åº¦å€ */
    .stats-container { display: flex; flex-direction: column; gap: 20px; }
    .stat-box { background: var(--color-section-bg); border-radius: var(--border-radius-lg); padding: 15px; box-shadow: var(--shadow-medium); border-top: 6px solid var(--color-primary); }
    .stat-row { display: flex; justify-content: space-between; align-items: center; padding: 10px; cursor: pointer; }
    .stat-row-progress { height: 6px; background-color: var(--color-light-gray); border-radius: 3px; margin: 0 10px 10px 10px; overflow: hidden; }
    .progress-fill { height: 100%; transition: width 0.3s ease; }
    
    .stat-detail-item { 
        display: flex; 
        align-items: center; 
        padding: 10px; 
        border-bottom: 1px solid #f5f5f5; 
        gap: 10px;
    }
    .stat-detail-item.done { background-color: var(--color-done-bg); opacity: 0.7; text-decoration: line-through; }
    .customer-info { flex: 1; }

    /* å–®å“è±†å–®è¡¨æ ¼ä¿®æ­£ */
    .table-responsive {
        width: 100%;
        overflow-x: auto; /* æ‰‹æ©Ÿç‰ˆå¯å·¦å³æ»‘å‹• */
        -webkit-overflow-scrolling: touch;
    }
    .menu-group-full { 
        width: 100%; 
        border-collapse: collapse; 
        min-width: 450px; /* ç¢ºä¿å…§å®¹ä¸æ“ å£“ */
    }
    .menu-group-full th { background-color: var(--color-secondary); color: white; padding: 10px 5px; font-size: 14px; }
    .menu-group-full td { padding: 10px 5px; text-align: center; font-size: 14px; border-bottom: 1px solid #eee; }
    .menu-price { color: var(--color-danger); font-weight: bold; }
    .menu-price::before { content: '$'; }

    /* åƒ¹æ ¼å¡ç‰‡ */
    .price-card-container { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
    .price-card { background: #fff; border-radius: var(--border-radius-lg); box-shadow: var(--shadow-subtle); overflow: hidden; border: 1px solid var(--color-light-gray); }
    .price-card-header { background: var(--color-primary); color: #fff; padding: 8px; font-weight: bold; text-align: center; }
    .price-item { display: flex; justify-content: space-between; padding: 8px 12px; border-bottom: 1px solid #f9f9f9; font-size: 14px; }
    .p-value { color: var(--color-danger); font-weight: bold; }

    @media (max-width: 600px) {
        .price-card-container { grid-template-columns: 1fr; }
        .controls { flex-direction: column; }
        .nav-btn { font-size: 14px; padding: 8px; }
    }
</style>
</head>
<body>

<div class="nav-header">
    <a href="https://christypy.github.io/time" class="nav-btn">â±ï¸ è¨ˆæ™‚å™¨</a>
    <a href="https://christypy.github.io/record" class="nav-btn">ğŸ“ è¨˜éŒ„å™¨</a>
</div>

<h2>â˜• ä¸€å‘³æ·¨ç”Ÿæ´»å’–å•¡å‚™é¤åŠ©ç†</h2>

<div class="controls">
    <select id="daySelect" onchange="renderOrders()">
        <option value="1">æ˜ŸæœŸä¸€ (ä¼‘)</option>
        <option value="2">æ˜ŸæœŸäºŒ</option>
        <option value="3">æ˜ŸæœŸä¸‰</option>
        <option value="4">æ˜ŸæœŸå››</option>
        <option value="5">æ˜ŸæœŸäº”</option>
        <option value="6">æ˜ŸæœŸå…­</option>
        <option value="0">æ˜ŸæœŸæ—¥</option>
    </select>
    <button class="btn" onclick="renderOrders()">åˆ·æ–°</button>
    <button class="btn" id="clearAllBtn" onclick="clearAllDone()">é‡ç½®ä»Šæ—¥</button>
</div>

<div class="info-section">
    <h3>ğŸ“ å¸¸é§å‚™å¿˜</h3>
    <ul id="staticMemoList" style="list-style: none; padding: 0;">
        <li>ğŸš© <b>æé¾å«©ä»™è‰ï¼š</b>ç’°ä¿æ¯ç†±ç¾å¼</li>
        <li>ğŸš© <b>å…§è¡£åº—è€é—†ï¼š</b>ç†±æ‹¿éµ</li>
        <li>ğŸš© <b>èŠ­æ¨‚ï¼š</b>ç†±æ‹¿éµ + ç³–(3g)</li>
    </ul>
    <ul id="dynamicMemoList" style="list-style: none; padding: 0; margin-top: 10px;"></ul>
</div>

<div class="stats-container">
    <div class="stat-box" style="border-top-color: var(--color-success);">
        <h3>ğŸ  å·¦å³é„°å±… ç¸½è¨ˆ</h3>
        <div id="stats-neighbor"></div>
    </div>
    <div class="stat-box" style="border-top-color: var(--color-total-progress);">
        <h3>ğŸ›µ å…¶ä»–å€åŸŸ ç¸½è¨ˆ</h3>
        <div id="stats-other"></div>
    </div>
</div>

<div class="price-card-container">
    <div class="price-card">
        <div class="price-card-header">â˜• ç¾©å¼åŸºç¤</div>
        <div class="price-item"><span>ç†±ç¾å¼</span><span class="p-value">70</span></div>
        <div class="price-item"><span>ç†±æ‹¿éµ</span><span class="p-value">85</span></div>
        <div class="price-item"><span>å†°ç¾å¼</span><span class="p-value">75</span></div>
        <div class="price-item"><span>å†°æ‹¿éµ</span><span class="p-value">85</span></div>
    </div>
    <div class="price-card">
        <div class="price-card-header">å…¶ä»–å“é …</div>
        <div class="price-item"><span>å¤§ç†±ç¾</span><span class="p-value">80</span></div>
        <div class="price-item"><span>å¤§ç†±æ‹¿</span><span class="p-value">95</span></div>
        <div class="price-item"><span>æŠ¹èŒ¶æ‹¿éµ</span><span class="p-value">85</span></div>
        <div class="price-item"><span>ç†±ç‰›å¥¶</span><span class="p-value">50</span></div>
    </div>
</div>

<div class="info-section">
    <h3>ğŸ“‹ å–®å“è±†å–®å®Œæ•´åƒ¹æ ¼</h3>
    <div class="table-responsive">
        <table class="menu-group-full">
            <thead>
                <tr>
                    <th>å“é …</th><th>å¤–å¸¶</th><th>å…§ç”¨</th><th>åŠç£…</th><th>æ¿¾æ›</th>
                </tr>
            </thead>
            <tbody>
                <tr><td><b>è¦º (å¿ƒ)</b></td><td class="menu-price">200</td><td class="menu-price">250</td><td class="menu-price">950</td><td>-</td></tr>
                <tr><td><b>èŠ± (ç™¼)</b></td><td class="menu-price">180</td><td class="menu-price">230</td><td class="menu-price">850</td><td class="menu-price">55</td></tr>
                <tr><td><b>å¯¶ (å—)</b></td><td class="menu-price">180</td><td class="menu-price">230</td><td class="menu-price">850</td><td class="menu-price">55</td></tr>
                <tr><td><b>è© (å—)</b></td><td class="menu-price">130</td><td class="menu-price">180</td><td class="menu-price">700</td><td class="menu-price">45</td></tr>
                <tr><td><b>é›… (é›…)</b></td><td class="menu-price">130</td><td class="menu-price">180</td><td class="menu-price">650</td><td class="menu-price">45</td></tr>
            </tbody>
        </table>
    </div>
</div>

<script>
    /* æ ¸å¿ƒé‚è¼¯ä¿æŒèˆ‡åŸå§‹æª”æ¡ˆä¸€è‡´ */
    const expandedStats = new Set();
    const customers = [
        { loc: "å³é‚Šé„°å±…", name: "æ€¡é¦™è»’", item: "ç†±ç¾å¼", type: "hot_am", days: [], count: 1, groupId: "neighbor_r_1" },
        { loc: "å³é‚Šé„°å±…", name: "æ²¹é£¯", item: "ç†±ç¾å¼", tag: "ç•¶æ—¥å•",type: "hot_am", days: [], count: 1, groupId: "neighbor_r_2"},
        { loc: "å³é‚Šé„°å±…", name: "å±±åŸç±³é£Ÿ", item: "ç†±æ‹¿éµ", type: "hot_latte", days: [], count: 1, note: "å¯„æ¯", groupId: "neighbor_r_3" }, 
        { loc: "å³é‚Šé„°å±…", name: "æ©˜å­æ”¤", item: "ç†±æ‹¿éµ", type: "hot_latte", days: [], count: 1, groupId: "neighbor_r_4" }, 
        { loc: "å³é‚Šé„°å±…", name: "ç³–æœ", item: "ç†±æ‹¿éµ", type: "hot_latte", days: [6, 0], count: 1, note: "ä»˜å…©å¤©", groupId: "neighbor_r_5" },
        { loc: "å·¦é‚Šé„°å±…", name: "ç‰›è‚‰", item: "ç†±æ‹¿éµ", type: "hot_latte_sugar", days: [3, 5, 0], count: 1, note: "åŠ 3gç³–", groupId: "neighbor_l_1" },
        { loc: "å·¦é‚Šé„°å±…", name: "å¸ƒè€é—†", item: "ç†±ç¾å¼", type: "hot_am", days: [5], count: 1, note: "å¯„æ¯", groupId: "neighbor_l_2" },
        { 
            loc: "å·¦é‚Šé„°å±…", 
            name: "ç”˜è”—é›", 
            item: [10, 11, 0, 1, 2].includes(new Date().getMonth()) ? "ç†±ç¾å¼" : "å†°ç¾å¼",
            type: [10, 11, 0, 1, 2].includes(new Date().getMonth()) ? "hot_am" : "ice_am",
            days: [], 
            count: 1, 
            groupId: "neighbor_l_3" 
        },
        { loc: "å·¦é‚Šé„°å±…", name: "åœ‹è¯å“¥", item: "å†°ç¾å¼", type: "ice_am", days: [], count: 1, groupId: "neighbor_l_4" },
        { loc: "å·¦é‚Šé„°å±…", name: "å®œè˜­é­šæ”¤", item: "å†°ç¾å¼", type: "ice_am", days: [6], count: 1, groupId: "neighbor_l_5" },
        { loc: "å·¦é‚Šé„°å±…", name: "å®œè˜­é­šæ”¤", item: "å†°æ‹¿éµ", type: "ice_latte_sugar", days: [6], count: 1 ,note:"åŠ ç³–", groupId: "neighbor_l_5"},
        { loc: "æé¾å«©ä»™è‰å°é¢", name: "è³£é­šçš„å“¡å·¥", item: "å¤§ç†±ç¾", type: "large_hot_am", days: [6,0], note: "å…­çµ¦å…©å¤©éŒ¢", groupId: "other_1" },
        { loc: "è¿‘åå­—è·¯å£", name: "ç‰›è‚‰çˆ¸çˆ¸", item: "å¤§æ‹¿éµ", count: 1, type: "large_hot_latte", days: [], note: "çˆ¸çˆ¸ç²‰20g", groupId: "other_2" },
        { loc: "è¿‘åå­—è·¯å£", name: "ç‰›è‚‰å…’å­", item: "å¤§æ‹¿éµ", count: 1, type: "large_hot_latte", days: [], groupId: "other_2" },
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "é­šè€é—†", item: "å¤§æ‹¿éµ", type: "large_hot_latte", days: [2, 3, 5], count: 1, note: "å¯„æ¯", groupId: "other_3" },
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "é­šè€é—†é„°å±…(æ°´æœ)", item: "ç†±æ‹¿éµ", type: "hot_latte", days: [2, 3, 6, 0], count: 1, groupId: "other_4" }, 
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "å°è¾£æ¤’", item: "ç†±ç¾å¼", type: "hot_am", days: [], count: 1, groupId: "other_5" },
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "è¦è€é—†", item: "ç†±ç¾å¼",type: "hot_am", days: [2, 4, 5, 6, 0], count: 1, groupId: "other_6" },
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "æ¢¨å±±èœœè˜‹æœ", item: "ç†±æ‹¿éµ",tag: "ç•¶æ—¥å•", type: "hot_latte", days: [4,5], count: 1, groupId: "other_7" }, 
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "åŸéšå»Ÿå£éµé‹è¡Œ", item: "å†°ç¾å¼",  count: 2, type: "ice_am", days: [5], groupId: "other_8" }, 
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "çœ¼é¡ç™½é«®å°èœè€é—†", item: "å†°æ‰‹æ²–|é›…", type: "hand_drip",tag: "ç•¶æ—¥å•è€å®¢æˆ¶æ‰‹æ²–100", days: [4], count: 1, groupId: "other_9"  },
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "æŠ“é¤…å¥³è€é—†", item: "ç†±ç¾å¼",tag: "ç•¶æ—¥å•", type: "hot_am", days: [2,4], count: 1, groupId: "other_10" },
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "è±åŸç´ é£Ÿ", item: "ç†±ç¾å¼", type: "hot_am", days: [3], count: 1, groupId: "other_11" },
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "è¿‘ä¸­å±±è·¯æ°´æœæ”¤", item: "ç†±ç¾å¼", type: "hot_am", days: [], count: 1, groupId: "other_12" },
        { loc: "éåå­—è·¯å£å³è½‰", name: "ç¦è¨˜å°é¢è±¬è‚‰", item: "ç†±ç¾å¼", type: "hot_am", days: [], count: 1, note: "å¯„æ¯", groupId: "other_13" },
        { loc: "å¸‚å ´å…§", name: "åœ‹è¯å“¥åª½åª½", item: "ç†±ç¾å¼", type: "hot_am", days: [2,5], count: 1, groupId: "other_14" },
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "åŸéšå»Ÿå£è²¢ä¸¸ ", item: "ç†±æ‹¿éµ", type: "hot_latte", days: [2], count: 1, groupId: "other_15" },
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "è²¢ä¸¸è€é—† (æ‹¿)", item: "ç†±æ‹¿éµ", type: "hot_latte", days: [3, 0], count: 1, groupId: "other_16" },
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "è²¢ä¸¸è€é—† (æ‰‹)", item: "ç†±æ‰‹æ²–", type: "hand_drip", days: [3, 0], count: 1, note: "ç¸½è¨ˆ$185", groupId: "other_16" },
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "èœè€é—†", item: "ç†±æ‹¿éµ", type: "hot_latte", days: [], count: 1, groupId: "other_17" },
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "åŸéšå»Ÿå£è±†è…", item: "å†°ç¾å¼",   type: "ice_am", days: [6], note:"ç•¶å¤©å•",groupId: "other_18" }, 
    ];

    const typeNames = {
        hot_am: 'â˜• ç†±ç¾å¼', ice_am: 'ğŸ§Š å†°ç¾å¼', large_hot_am:"â˜•ï¸ å¤§ç†±ç¾",
        hot_latte: 'ğŸ”¥ ç†±æ‹¿éµ', hot_latte_sugar: 'ğŸ¬ ç†±æ‹¿éµ (åŠ ç³–)', 
        ice_latte_sugar: 'ğŸ­ å†°æ‹¿éµ (åŠ ç³–)', ice_latte: 'â„ï¸ å†°æ‹¿éµ', 
        large_hot_latte: 'ğŸ¥¤ å¤§ç†±æ‹¿', hand_drip: 'ğŸ’§ æ‰‹æ²–', potential_item: 'â“ å¾…ç¢ºèª'
    };

    function getTodayDateString() {
        const today = new Date();
        return today.getFullYear() + (today.getMonth() + 1).toString().padStart(2, '0') + today.getDate().toString().padStart(2, '0');
    }

    function sanitizeKeyPart(s) { return s ? s.replace(/ /g, '_').replace(/[^a-zA-Z0-9\u4e00-\u9fa5_]/g, '') : ''; }
    function getStorageKey(name, item, loc, index = 0) { return `${getTodayDateString()}_${sanitizeKeyPart(name)}_${sanitizeKeyPart(item)}_${sanitizeKeyPart(loc)}_${index}`; }
    function getAbsenceKey(groupId) { return `${getTodayDateString()}_absent_${groupId}`; }
    function escapeJsString(s) { return s ? s.replace(/\\/g, '\\\\').replace(/'/g, '\\\'') : ''; }

    window.toggleDone = function(name, item, loc, index, groupId) {
        if (isGroupAbsent(groupId)) { alert("è©²çµ„å·²æ¨™è¨˜ç‚ºã€Œç¼ºå¸­ã€ï¼"); return; }
        const key = getStorageKey(name, item, loc, index);
        localStorage.getItem(key) === 'true' ? localStorage.removeItem(key) : localStorage.setItem(key, 'true'); 
        renderOrders(); 
    }

    window.toggleAbsence = function(groupId) {
        const key = getAbsenceKey(groupId);
        if (localStorage.getItem(key) === 'true') {
            localStorage.removeItem(key); 
        } else {
            localStorage.setItem(key, 'true'); 
            const day = parseInt(document.getElementById('daySelect').value);
            customers.filter(c => c.groupId === groupId && (c.days.length === 0 || c.days.includes(day))).forEach(c => {
                for(let i = 0; i < (c.count || 1); i++) localStorage.removeItem(getStorageKey(c.name, c.item, c.loc, i));
            });
        }
        renderOrders(); 
    }

    function isItemDone(name, item, loc, index = 0) { return localStorage.getItem(getStorageKey(name, item, loc, index)) === 'true'; }
    function isGroupAbsent(groupId) { return groupId ? localStorage.getItem(getAbsenceKey(groupId)) === 'true' : false; }
    
    window.clearAllDone = function() {
        if (!confirm("ç¢ºå®šè¦é‡ç½®ä»Šæ—¥æ‰€æœ‰ç‹€æ…‹å—ï¼Ÿ")) return;
        const day = parseInt(document.getElementById('daySelect').value);
        const todaysOrders = customers.filter(c => c.days.length === 0 || c.days.includes(day));
        todaysOrders.forEach(c => {
            for(let i = 0; i < (c.count || 1); i++) localStorage.removeItem(getStorageKey(c.name, c.item, c.loc, i));
            if(c.groupId) localStorage.removeItem(getAbsenceKey(c.groupId));
        });
        renderOrders();
    }

    function renderOrders() {
        const day = parseInt(document.getElementById('daySelect').value);
        const sNDiv = document.getElementById('stats-neighbor');
        const sODiv = document.getElementById('stats-other');
        
        if (day === 1) { 
            sNDiv.innerHTML = sODiv.innerHTML = '<div style="text-align:center;color:#999;padding:10px;">æœ¬æ—¥ä¼‘æ¯</div>';
            return; 
        }

        let sNeigh = {}, sOther = {};
        for (const k in typeNames) { sNeigh[k] = {total:0, done:0, orders:[]}; sOther[k] = {total:0, done:0, orders:[]}; }

        const todaysOrders = customers.filter(c => c.days.length === 0 || c.days.includes(day));

        todaysOrders.forEach(c => {
            let target = (c.loc.includes("é„°å±…")) ? sNeigh : sOther;
            let isAbsent = isGroupAbsent(c.groupId);
            if (typeNames[c.type]) {
                if (!isAbsent) target[c.type].total += (c.count || 1);
                for(let i=0; i<(c.count||1); i++){
                    let done = isItemDone(c.name, c.item, c.loc, i);
                    if (done && !isAbsent) target[c.type].done++;
                    target[c.type].orders.push({...c, isDone: done, isAbsent, index: i});
                }
            }
        });

        const makeHtml = (stats, prefix) => {
            let html = '';
            for (const k in typeNames) {
                if (stats[k].total > 0) {
                    let s = stats[k], rem = s.total - s.done, per = Math.round((s.done/s.total)*100), id = `detail_${prefix}_${k}`;
                    html += `<div class="stat-row" onclick="toggleStatDetail('${id}')"><span>${typeNames[k]}</span><span>${s.total} (å‰©: ${rem})</span></div><div class="stat-row-progress"><div class="progress-fill" style="width:${per}%; background-color:var(--color-accent);"></div></div><div id="${id}" style="display:block;">${s.orders.map(o => {
                        let safe = [escapeJsString(o.name), escapeJsString(o.item), escapeJsString(o.loc), o.index, o.groupId];
                        return `<div class="stat-detail-item ${o.isAbsent?'absent':(o.isDone?'done':'')}"><span class="absence-toggle" onclick="event.stopPropagation(); toggleAbsence('${o.groupId}')">${o.isAbsent?'æ¢å¾©':'ç¼ºå¸­'}</span><div class="customer-info" onclick="toggleDone('${safe[0]}','${safe[1]}','${safe[2]}',${safe[3]},'${safe[4]}')"><b>${o.name}</b> - ${o.item}</div><input type="checkbox" ${o.isDone?'checked':''} ${o.isAbsent?'disabled':''}></div>`
                    }).join('')}</div>`;
                }
            }
            return html || 'ç„¡è¨‚å–®';
        };
        sNDiv.innerHTML = makeHtml(sNeigh, 'n'); sODiv.innerHTML = makeHtml(sOther, 'o');
    }

    window.toggleStatDetail = function(id) {
        const el = document.getElementById(id);
        el.style.display = el.style.display === 'none' ? 'block' : 'none';
    }

    document.getElementById('daySelect').value = new Date().getDay();
    renderOrders();
</script>
</body>
</html>

