<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ä¸€å‘³æ·¨ç”Ÿæ´»å’–å•¡ç³»çµ±</title>
<style>
    :root {
        --color-primary: #5c3a21; 
        --color-secondary: #9a6e4e; 
        --color-accent: #e2b34a; 
        --color-background: #fdf6e9; 
        --color-light-gray: #e6e0d8; 
        --color-done-bg: #f5f0e7; 
        --color-success: #4a7d4a; 
        --color-danger: #cf4a4a; 
        --color-total-progress: #d68910; 
        --color-section-bg: #ffffff; 
        --color-text: #333333; 

        --shadow-subtle: 0 1px 4px rgba(0,0,0,0.08);
        --shadow-medium: 0 3px 8px rgba(0,0,0,0.1);
        --border-radius-lg: 12px;
        --border-radius-md: 8px;
    }

    body { 
        font-family: 'Noto Sans TC', -apple-system, BlinkMacSystemFont, sans-serif; 
        background: var(--color-background); 
        padding: 0 10px 30px 10px; 
        color: var(--color-text); 
        max-width: 960px; 
        margin: 0 auto;
        line-height: 1.5;
    }

    h2 { 
        text-align: center; 
        color: var(--color-primary); 
        margin: 15px 0 10px 0; 
        font-size: 24px; 
        font-weight: 700;
    }

    /* é ‚éƒ¨æŒ‰éˆ• */
    .nav-container {
        display: flex;
        gap: 8px;
        justify-content: center;
        margin-bottom: 15px;
    }
    .nav-btn {
        background: #607d8b;
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 20px;
        font-size: 14px;
        cursor: pointer;
        text-decoration: none;
        flex: 1;
        max-width: 120px;
        text-align: center;
    }

    .info-section {
        background: var(--color-section-bg);
        padding: 12px;
        border-radius: var(--border-radius-lg);
        box-shadow: var(--shadow-medium);
        margin-bottom: 15px;
        border-left: 5px solid var(--color-secondary);
    }
    .info-section h3 {
        color: var(--color-primary);
        font-size: 16px;
        margin: 0 0 8px 0;
        border-bottom: 2px dashed var(--color-light-gray);
        padding-bottom: 5px;
    }

    /* æ§åˆ¶å€ */
    .controls { 
        background: var(--color-section-bg); 
        padding: 12px; 
        border-radius: var(--border-radius-lg); 
        box-shadow: var(--shadow-subtle); 
        margin-bottom: 15px; 
        display: flex; 
        gap: 8px; 
        flex-wrap: wrap;
    }
    select { 
        padding: 10px; 
        font-size: 15px; 
        border-radius: var(--border-radius-md); 
        border: 1px solid var(--color-light-gray); 
        flex: 2;
        min-width: 120px;
    }
    .btn { 
        background: var(--color-accent); 
        color: var(--color-primary); 
        border: none; 
        padding: 10px; 
        border-radius: var(--border-radius-md); 
        cursor: pointer; 
        font-weight: bold; 
        flex: 1;
    }
    #clearAllBtn { background: #aaaaaa; color: white; }

    /* çµ±è¨ˆå€ */
    .stats-container { display: flex; gap: 15px; margin-bottom: 15px; flex-direction: column; }
    @media (min-width: 768px) { .stats-container { flex-direction: row; } }
    
    .stat-box { flex: 1; background: var(--color-section-bg); border-radius: var(--border-radius-lg); padding: 12px; box-shadow: var(--shadow-medium); border-top: 6px solid var(--color-primary); }
    .stat-row { display: flex; justify-content: space-between; align-items: center; padding: 6px 5px; cursor: pointer; font-size: 14px; }
    .stat-row-progress { height: 4px; background: var(--color-light-gray); border-radius: 2px; margin-bottom: 8px; overflow: hidden; }
    .progress-fill { height: 100%; background: var(--color-accent); }

    /* åƒ¹æ ¼å¡ç‰‡ */
    .price-card-container { display: grid; grid-template-columns: 1fr; gap: 15px; }
    @media (min-width: 600px) { .price-card-container { grid-template-columns: 1fr 1fr; } }
    
    .price-card { background: #fff; border-radius: var(--border-radius-lg); border: 1px solid var(--color-light-gray); overflow: hidden; }
    .price-card-header { background: var(--color-primary); color: #fff; padding: 8px; font-weight: bold; text-align: center; font-size: 15px; }
    .price-grid { display: grid; grid-template-columns: 1fr 1fr; padding: 5px; }
    .price-item { padding: 6px 8px; border-bottom: 1px solid #f0f0f0; display: flex; justify-content: space-between; font-size: 13px; }
    .p-value { color: var(--color-danger); font-weight: bold; }
    .p-value::before { content: '$'; }

    /* å–®å“è±†å–®è¡¨æ ¼ - ç„¡æ²è»¸å„ªåŒ– */
    .menu-group-full { width: 100%; border-collapse: collapse; table-layout: fixed; }
    .menu-group-full th { background: var(--color-secondary); color: white; padding: 8px 2px; font-size: 13px; }
    .menu-group-full td { padding: 8px 2px; text-align: center; font-size: 12px; border-bottom: 1px solid #eee; }
    .menu-price { color: var(--color-danger); font-weight: bold; }
    .menu-price::before { content: '$'; }
    .menu-price:empty::before { content: ''; }

    /* è¨‚å–®æ˜ç´°æ¸…å–®æ¨£å¼ */
    .stat-detail-list { display: none; padding: 5px 0; border-top: 1px dashed var(--color-light-gray); }
    .stat-detail-item { display: flex; align-items: center; padding: 8px 5px; border-bottom: 1px dotted #e0e0e0; font-size: 13px; }
    .customer-info { flex: 1; display: flex; flex-direction: column; }
    .customer-name { font-weight: bold; color: var(--color-primary); }
    .stat-detail-item.done { background: var(--color-done-bg); opacity: 0.6; text-decoration: line-through; }
    .customer-tag { font-size: 10px; background: var(--color-accent); padding: 1px 4px; border-radius: 3px; margin-left: 5px; }
</style>
</head>
<body>

<div class="nav-container">
    <a href="https://christypy.github.io/time" class="nav-btn">â±ï¸ è¨ˆæ™‚å™¨</a>
    <a href="https://christypy.github.io/record" class="nav-btn">ğŸ“ è¨˜éŒ„å™¨</a>
</div>

<h2>â˜• ä¸€å‘³æ·¨ç”Ÿæ´»å’–å•¡å‚™é¤åŠ©ç†</h2>

<div class="controls">
    <select id="daySelect" onchange="renderOrders()">
        <option value="1">æ˜ŸæœŸä¸€ (ä¼‘)</option>
        <option value="2">æ˜ŸæœŸäºŒ</option>
        <option value="3">æ˜ŸæœŸä¸‰</option>
        <option value="4">æ˜ŸæœŸå››</option>
        <option value="5">æ˜ŸæœŸäº”</option>
        <option value="6">æ˜ŸæœŸå…­</option>
        <option value="0">æ˜ŸæœŸæ—¥</option>
    </select>
    <button class="btn" onclick="renderOrders()">åˆ·æ–°åˆ—è¡¨</button>
    <button class="btn" id="clearAllBtn" onclick="clearAllDone()">å…¨éƒ¨é‡ç½®</button>
</div>

<div class="info-section">
    <h3>ğŸ“ å¸¸é§å‚™å¿˜</h3>
    <ul id="staticMemoList" style="list-style: none; padding:0; font-size:14px;">
        <li><b style="color:var(--color-danger)">æé¾å«©ä»™è‰ï¼š</b>ç’°ä¿æ¯ç†±ç¾å¼</li>
        <li><b style="color:var(--color-danger)">å…§è¡£åº—è€é—†ï¼š</b>ç†±æ‹¿éµ</li>
        <li><b style="color:var(--color-danger)">èŠ­æ¨‚ï¼š</b>ç†±æ‹¿éµ + ç³–(3g)</li>
    </ul>
    <div id="dynamicMemoList"></div>
</div>

<div class="stats-container">
    <div class="stat-box" style="border-top-color: var(--color-success);">
        <h3>ğŸ  å·¦å³é„°å±…</h3>
        <div id="stats-neighbor"></div>
    </div>
    <div class="stat-box" style="border-top-color: var(--color-total-progress);">
        <h3>ğŸ›µ å…¶ä»–å€åŸŸ</h3>
        <div id="stats-other"></div>
    </div>
</div>

<div class="price-card-container">
    <div class="price-card">
        <div class="price-card-header">â˜• ç¾©å¼åŸºç¤é£²å“</div>
        <div class="price-grid">
            <div class="price-item"><span>ç†±ç¾å¼</span><span class="p-value">70</span></div>
            <div class="price-item"><span>ç†±æ‹¿éµ</span><span class="p-value">85</span></div>
            <div class="price-item"><span>å†°ç¾å¼</span><span class="p-value">75</span></div>
            <div class="price-item"><span>å†°æ‹¿éµ</span><span class="p-value">85</span></div>
            <div class="price-item"><span>å¤§ç†±ç¾</span><span class="p-value">80</span></div>
            <div class="price-item"><span>å¤§ç†±æ‹¿</span><span class="p-value">95</span></div>
            <div class="price-item"><span>ç†±ç‰›å¥¶</span><span class="p-value">50</span></div>
            <div class="price-item"><span>æŠ¹èŒ¶æ­è•¾</span><span class="p-value">85</span></div>
            <div class="price-item"><span>å·§å…‹åŠ›æ­è•¾</span><span class="p-value">85</span></div>
        </div>
    </div>
    <div class="price-card">
        <div class="price-card-header">å…¶ä»–å“é …</div>
        <div class="price-grid">
            <div class="price-item"><span>é…¸æŸ‘èŒ¶(å°)</span><span class="p-value">160</span></div>
            <div class="price-item"><span>å³æº¶(1æ¢)</span><span class="p-value">16</span></div>
            <div class="price-item"><span>é…¸æŸ‘èŒ¶(å¤§)</span><span class="p-value">950</span></div>
            <div class="price-item"><span>å³æº¶(30æ¢)</span><span class="p-value">475</span></div>
            <div class="price-item"><span>é…¸æŸ‘èŒ¶(100)</span><span class="p-value">1440</span></div>
            <div class="price-item"><span>å³æº¶(100)</span><span class="p-value">1450</span></div>
            <div class="price-item"><span>å°æ¿¾ç´™</span><span class="p-value">120</span></div>
            <div class="price-item"><span>å¤§æ¿¾ç´™</span><span class="p-value">130</span></div>
            <div class="price-item"><span>æ¿¾æ›ç´™(50)</span><span class="p-value">150</span></div>
        </div>
    </div>
</div>

<div class="info-section" style="margin-top:20px;">
    <h3>ğŸ“‹ å–®å“è±†å–® (å®Œæ•´ç‰ˆ)</h3>
    <table class="menu-group-full">
        <thead>
            <tr><th width="20%">å“é …</th><th>å¤–å¸¶</th><th>å…§ç”¨</th><th>åŠç£…</th><th>æ¿¾æ›</th></tr>
        </thead>
        <tbody>
            <tr><td>è¦º</td><td><span class="menu-price">200</span></td><td><span class="menu-price">250</span></td><td><span class="menu-price">950</span></td><td>-</td></tr>
            <tr><td>èŠ±</td><td><span class="menu-price">180</span></td><td><span class="menu-price">230</span></td><td><span class="menu-price">850</span></td><td><span class="menu-price">55</span></td></tr>
            <tr><td>å¯¶</td><td><span class="menu-price">180</span></td><td><span class="menu-price">230</span></td><td><span class="menu-price">850</span></td><td><span class="menu-price">55</span></td></tr>
            <tr><td>è©</td><td><span class="menu-price">130</span></td><td><span class="menu-price">180</span></td><td><span class="menu-price">700</span></td><td><span class="menu-price">45</span></td></tr>
            <tr><td>é›…</td><td><span class="menu-price">130</span></td><td><span class="menu-price">180</span></td><td><span class="menu-price">650</span></td><td><span class="menu-price">45</span></td></tr>
            <tr><td>éœ</td><td><span class="menu-price">130</span></td><td><span class="menu-price">180</span></td><td><span class="menu-price">650</span></td><td><span class="menu-price">45</span></td></tr>
            <tr><td>æœ</td><td><span class="menu-price">130</span></td><td><span class="menu-price">180</span></td><td><span class="menu-price">600</span></td><td><span class="menu-price">45</span></td></tr>
            <tr><td>ç¦</td><td><span class="menu-price">130</span></td><td><span class="menu-price">180</span></td><td><span class="menu-price">550</span></td><td><span class="menu-price">35</span></td></tr>
            <tr><td>æŸ”</td><td><span class="menu-price">130</span></td><td><span class="menu-price">180</span></td><td><span class="menu-price">450</span></td><td><span class="menu-price">35</span></td></tr>
            <tr><td>å®š</td><td>-</td><td>-</td><td><span class="menu-price">650</span></td><td>-</td></tr>
            <tr><td>çœŸ</td><td>-</td><td>-</td><td>-</td><td>-</td></tr>
            <tr><td>æ½¤</td><td>-</td><td>-</td><td>-</td><td>-</td></tr>
        </tbody>
    </table>
</div>

<script>
    // ä¿æŒåŸå§‹é‚è¼¯ï¼Œåƒ…æ›´æ–°é¡¯ç¤º
    const expandedStats = new Set();
    const customers = [
        { loc: "å³é‚Šé„°å±…", name: "æ€¡é¦™è»’", item: "ç†±ç¾å¼", type: "hot_am", days: [], count: 1, groupId: "neighbor_r_1" },
        { loc: "å³é‚Šé„°å±…", name: "æ²¹é£¯", item: "ç†±ç¾å¼", tag: "ç•¶æ—¥å•",type: "hot_am", days: [], count: 1, groupId: "neighbor_r_2"},
        { loc: "å³é‚Šé„°å±…", name: "å±±åŸç±³é£Ÿ", item: "ç†±æ‹¿éµ", type: "hot_latte", days: [], count: 1, note: "å¯„æ¯", groupId: "neighbor_r_3" }, 
        { loc: "å³é‚Šé„°å±…", name: "æ©˜å­æ”¤", item: "ç†±æ‹¿éµ", type: "hot_latte", days: [], count: 1, groupId: "neighbor_r_4" }, 
        { loc: "å³é‚Šé„°å±…", name: "ç³–æœ", item: "ç†±æ‹¿éµ", type: "hot_latte", days: [6, 0], count: 1, note: "ä»˜å…©å¤©", groupId: "neighbor_r_5" },
        { loc: "å·¦é‚Šé„°å±…", name: "ç‰›è‚‰", item: "ç†±æ‹¿éµ", type: "hot_latte_sugar", days: [3, 5, 0], count: 1, note: "åŠ 3gç³–", groupId: "neighbor_l_1" },
        { loc: "å·¦é‚Šé„°å±…", name: "å¸ƒè€é—†", item: "ç†±ç¾å¼", type: "hot_am", days: [5], count: 1, note: "å¯„æ¯", groupId: "neighbor_l_2" },
        { loc: "å·¦é‚Šé„°å±…", name: "ç”˜è”—é›", item: "å­£ç¯€ç¾å¼", type: "hot_am", days: [], count: 1, groupId: "neighbor_l_3" },
        { loc: "å·¦é‚Šé„°å±…", name: "åœ‹è¯å“¥", item: "å†°ç¾å¼", type: "ice_am", days: [], count: 1, groupId: "neighbor_l_4" },
        { loc: "å·¦é‚Šé„°å±…", name: "å®œè˜­é­šæ”¤", item: "å†°ç¾å¼", type: "ice_am", days: [6], count: 1, groupId: "neighbor_l_5" },
        { loc: "å…¶ä»–å€åŸŸ", name: "è³£é­šå“¡å·¥", item: "å¤§ç†±ç¾", type: "large_hot_am", days: [6,0], groupId: "other_1" },
        { loc: "è¿‘åå­—è·¯å£", name: "ç‰›è‚‰çˆ¸çˆ¸", item: "å¤§æ‹¿éµ", type: "large_hot_latte", days: [], groupId: "other_2" },
        { loc: "éåå­—è·¯å£ç›´è¡Œ", name: "é­šè€é—†", item: "å¤§æ‹¿éµ", type: "large_hot_latte", days: [2, 3, 5], groupId: "other_3" }
    ];

    const typeNames = {
        hot_am: 'â˜• ç†±ç¾å¼', ice_am: 'ğŸ§Š å†°ç¾å¼', large_hot_am:"â˜•ï¸ å¤§ç†±ç¾",
        hot_latte: 'ğŸ”¥ ç†±æ‹¿éµ', hot_latte_sugar: 'ğŸ¬ ç†±æ‹¿éµ (åŠ ç³–)', 
        large_hot_latte: 'ğŸ¥¤ å¤§ç†±æ‹¿', hand_drip: 'ğŸ’§ æ‰‹æ²–'
    };

    function getTodayDateString() {
        const t = new Date();
        return t.getFullYear() + (t.getMonth()+1).toString().padStart(2,'0') + t.getDate().toString().padStart(2,'0');
    }

    function isItemDone(name, item, loc, index) {
        return localStorage.getItem(`${getTodayDateString()}_${name}_${item}_${index}`) === 'true';
    }

    window.toggleDone = function(name, item, loc, index) {
        const key = `${getTodayDateString()}_${name}_${item}_${index}`;
        localStorage.getItem(key) === 'true' ? localStorage.removeItem(key) : localStorage.setItem(key, 'true');
        renderOrders();
    }

    function renderOrders() {
        const day = parseInt(document.getElementById('daySelect').value);
        const sNDiv = document.getElementById('stats-neighbor');
        const sODiv = document.getElementById('stats-other');
        
        if (day === 1) { 
            sNDiv.innerHTML = sODiv.innerHTML = '<div style="text-align:center;color:#999;padding:10px;">æœ¬æ—¥ä¼‘æ¯</div>';
            return; 
        }

        let sNeigh = {}, sOther = {};
        for (const k in typeNames) { sNeigh[k] = {total:0, done:0, orders:[]}; sOther[k] = {total:0, done:0, orders:[]}; }

        const todaysOrders = customers.filter(c => c.days.length === 0 || c.days.includes(day));

        todaysOrders.forEach(c => {
            let target = (c.loc.includes("é„°å±…")) ? sNeigh : sOther;
            if (typeNames[c.type]) {
                target[c.type].total += (c.count || 1);
                for(let i=0; i<(c.count||1); i++){
                    let done = isItemDone(c.name, c.item, c.loc, i);
                    if (done) target[c.type].done++;
                    target[c.type].orders.push({...c, isDone: done, index: i});
                }
            }
        });

        const makeHtml = (stats, prefix) => {
            let html = '';
            for (const k in typeNames) {
                if (stats[k].total > 0) {
                    let s = stats[k], rem = s.total - s.done, per = Math.round((s.done/s.total)*100), id = `detail_${prefix}_${k}`;
                    html += `<div class="stat-row" onclick="toggleStatDetail('${id}')"><span>${typeNames[k]}</span><span>${s.total} (å‰©: ${rem})</span></div>
                            <div class="stat-row-progress"><div class="progress-fill" style="width:${per}%"></div></div>
                            <div id="${id}" class="stat-detail-list" style="display:block;">
                            ${s.orders.map(o => `<div class="stat-detail-item ${o.isDone?'done':''}" onclick="toggleDone('${o.name}','${o.item}','${o.loc}',${o.index})">
                                <div class="customer-info"><span class="customer-name">${o.name}</span><span>${o.item}</span></div>
                                <input type="checkbox" ${o.isDone?'checked':''}>
                            </div>`).join('')}</div>`;
                }
            }
            return html || 'ç„¡è¨‚å–®';
        };
        sNDiv.innerHTML = makeHtml(sNeigh, 'n');
        sODiv.innerHTML = makeHtml(sOther, 'o');
    }

    window.toggleStatDetail = function(id) {
        const el = document.getElementById(id);
        el.style.display = el.style.display === 'none' ? 'block' : 'none';
    }

    window.clearAllDone = function() {
        if(confirm("é‡ç½®ä»Šæ—¥å®Œæˆç‹€æ…‹ï¼Ÿ")) {
            localStorage.clear(); // ç°¡åŒ–è™•ç†
            renderOrders();
        }
    }

    document.getElementById('daySelect').value = new Date().getDay();
    renderOrders();
</script>
</body>
</html>
